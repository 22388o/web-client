{"version":3,"sources":["images/banner-bg.jpg","images/av1.jpg","images/lightning-logo.svg","utils/Cache.js","utils/Promise.js","utils/Torrents.js","pages/User/index.js"],"names":["module","exports","getCachedFile","fileName","a","FileCache","_init","Promise","resolve","reject","init","then","console","log","persist","status","persistent","load","cachedFile","createURL","warn","renderCachedFile","fileURL","selector","elements","document","querySelectorAll","length","forEach","element","src","muted","autoplay","saveFile","buffer","save","runSerial","tasks","result","task","supportedFileTypes","formats","options","_getFileType","file","extension","name","split","slice","supportedFileType","Object","entries","filter","includes","fileType","webTorrentClient","WebTorrent","Post","React","lazy","UserPage","dispatch","useDispatch","params","useParams","wall","useSelector","user","profile","me","auth","pair","paymentRequest","transaction","useState","setUserLoading","wallLoading","setWallLoading","tipModalOpen","setTipModalOpen","tipLoading","setTipLoading","tipAmount","setTipAmount","isOnlineApp","setIsOnlineApp","isOnlineNode","setIsOnlineNode","copied","setCopied","onlineCheckTimer","setOnlineCheckTimer","targetType","tipMetadata","setTipMetadata","publicKey","userId","fetchUserData","useCallback","resetUserData","getUserProfile","getUserHeader","getUserAvatar","error","fetchUserWall","resetUserWall","getUserWall","sendTip","payUser","senderPair","recipientPublicKey","amount","metadata","openTipModal","closeTipModal","resetPaymentRequest","initializeUserWall","generateGunPair","useEffect","lastSeenAppListener","listenPath","path","gunPointer","gunUser","callback","event","updateUserProfile","lastSeenApp","lastSeenNodeListener","lastSeenNode","displayNameListener","displayName","bioListener","bio","off","posts","torrentMode","torrentTasks","map","post","contentItems","id","item","type","key","get","magnetURI","add","torrent","files","target","destroy","torrentElements","torrentElement","renderTo","contentURL","decodeURIComponent","replace","setAttribute","on","getBlob","err","blob","querySelector","dataset","played","reduce","torrents","attachMedia","clearTimeout","timer","setTimeout","onlineThreshold","Moment","utc","subtract","isSameOrAfter","setCopiedStatus","ReactTooltip","rebuild","username","alias","className","style","backgroundImage","header","defaultBanner","avatar","av1","color","onClick","opacity","cursor","data-tip","shockLogo","alt","fallback","Loader","text","timestamp","date","page","tipValue","tipCounter","value","size","bgColor","fgColor","href","onCopy","onChange","e"],"mappings":"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","file":"static/js/4.ca201152.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/banner-bg.f59337b5.jpg\";","module.exports = __webpack_public_path__ + \"static/media/av1.48bf5c6a.jpg\";","module.exports = __webpack_public_path__ + \"static/media/lightning-logo.ea3bd789.svg\";","import FileCache from \"browser-file-storage\";\n\nexport const DB_NAME = \"ShockWalletStore\";\n\nexport const init = () =>\n  new Promise((resolve, reject) => {\n    FileCache.init(DB_NAME)\n      .then(() => {\n        console.log(\"File cache initialized!\");\n        return FileCache.persist();\n      })\n      .then(status => {\n        if (status.persistent) {\n          resolve(status);\n        } else {\n          reject(status);\n        }\n      });\n  });\n\nexport const getCachedFile = async fileName => {\n  try {\n    if (!FileCache._init) {\n      await init();\n    }\n\n    const cachedFile = await FileCache.load(fileName);\n    return cachedFile.createURL();\n  } catch (err) {\n    console.warn(err);\n    return false;\n  }\n};\n\nexport const renderCachedFile = (fileURL, selector) => {\n  const elements = document.querySelectorAll(selector);\n  if (elements && elements.length) {\n    elements.forEach(element => {\n      element.src = fileURL;\n      element.muted = true;\n      element.autoplay = true;\n    });\n  }\n  return !!elements && !!elements.length;\n};\n\nexport const saveFile = (fileName, buffer) => {\n  return FileCache.save(fileName, buffer);\n};\n","export const runSerial = tasks => {\n  let result = Promise.resolve();\n  tasks.forEach(task => {\n    result = result.then(() => task());\n  });\n  return result;\n};\n","import WebTorrent from \"webtorrent\";\nimport { getCachedFile, renderCachedFile, saveFile } from \"./Cache\";\nimport { runSerial } from \"./Promise\";\n\nconst supportedFileTypes = {\n  \"video/embedded\": {\n    formats: [\"mp4\", \"webm\"],\n    element: \"video\",\n    options: {\n      autoplay: true,\n      muted: true\n    }\n  },\n  \"image/embedded\": {\n    formats: [\"jpg\", \"png\", \"webp\", \"jpeg\"],\n    element: \"img\",\n    options: {}\n  }\n};\n\nconst _getFileType = file => {\n  const extension = file.name?.split(\".\")?.slice(-1)[0];\n  const supportedFileType = Object.entries(\n    supportedFileTypes\n  ).filter(([type, options]) => options.formats.includes(extension))[0];\n\n  if (supportedFileType) {\n    const [name, fileType] = supportedFileType;\n    return {\n      name,\n      ...fileType\n    };\n  }\n\n  return null;\n};\n\nexport const webTorrentClient = new WebTorrent();\n\nexport const attachMedia = (posts = [], torrentMode = true) => {\n  const torrentTasks = posts\n    .map(post => {\n      const { contentItems, id } = post;\n      return Object.entries(contentItems)\n        .filter(([key, item]) => supportedFileTypes[item.type])\n        .map(([key, item]) => () =>\n          new Promise(resolve => {\n            const torrentExists = webTorrentClient.get(item.magnetURI);\n\n            if (torrentExists) {\n              resolve(true);\n              return;\n            }\n\n            webTorrentClient.add(item.magnetURI, async torrent => {\n              // Proceed to the next torrent in queue\n              resolve(true);\n\n              const files = torrent.files.filter(file => {\n                const extension = file.name?.split(\".\")?.slice(-1)[0];\n                const supportedFileType = Object.entries(\n                  supportedFileTypes\n                ).filter(([type, options]) =>\n                  options.formats.includes(extension)\n                )[0];\n                if (supportedFileType) {\n                  const [, fileType] = supportedFileType;\n                  const matched = fileType.formats.includes(extension);\n                  return matched;\n                }\n                return false;\n              });\n\n              files.map(async file => {\n                const fileType = _getFileType(file);\n\n                if (!fileType) {\n                  return;\n                }\n\n                const fileName = `${id}-${key}-${file.name}`;\n\n                const element = fileType.element;\n                const target = `${element}[data-torrent=\"${item.magnetURI}\"]`;\n                const cachedFile = await getCachedFile(fileName);\n\n                if (cachedFile) {\n                  const torrent = webTorrentClient.get(item.magnetURI);\n\n                  if (torrent) {\n                    torrent.destroy();\n                  }\n\n                  renderCachedFile(cachedFile, target);\n                  return;\n                }\n\n                const torrentElements = document.querySelectorAll(target);\n                console.log(\"Torrent Elements:\", torrentElements);\n                torrentElements.forEach(torrentElement => {\n                  if (torrentMode) {\n                    file.renderTo(torrentElement, fileType.options);\n                    return;\n                  }\n\n                  const contentURL = decodeURIComponent(\n                    item.magnetURI.replace(/.*(ws=)/gi, \"\")\n                  );\n                  torrentElement.setAttribute(\"src\", contentURL);\n                });\n              });\n\n              torrent.on(\"done\", () => {\n                files.map(file => {\n                  const fileType = _getFileType(file);\n                  const fileName = `${id}-${key}-${file.name}`;\n                  const element = fileType.element;\n                  const target = `${element}[data-torrent=\"${item.magnetURI}\"]`;\n\n                  file.getBlob(async (err, blob) => {\n                    if (err) {\n                      console.warn(err);\n                      return;\n                    }\n\n                    console.log(\"Caching loaded file...\", fileName, blob);\n                    await saveFile(fileName, blob);\n                    const element = document.querySelector(target);\n                    if (element.dataset.played === \"false\") {\n                      const cachedFile = await getCachedFile(fileName);\n                      renderCachedFile(cachedFile, target);\n                    }\n                  });\n                });\n              });\n            });\n          })\n        );\n    })\n    .reduce((torrents, contentItems) => [...torrents, ...contentItems], []);\n\n  runSerial(torrentTasks);\n};\n","import React, { useEffect, useState, useCallback, Suspense } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useParams } from \"react-router-dom\";\nimport QRCode from \"react-qr-code\";\nimport Moment from \"moment\";\nimport CopyClipboard from \"react-copy-to-clipboard\";\n\nimport {\n  getUserWall,\n  resetUserWall,\n  resetUserData,\n  getUserProfile,\n  getUserAvatar,\n  updateUserProfile,\n  getUserHeader\n} from \"../../actions/UserActions\";\nimport { generateGunPair } from \"../../actions/AuthActions\";\nimport { payUser, resetPaymentRequest } from \"../../actions/TransactionActions\";\nimport { listenPath, gunUser } from \"../../utils/Gun\";\nimport { webTorrentClient, attachMedia } from \"../../utils/Torrents\";\n\nimport Loader from \"../../components/Loader\";\n\n// Assets\nimport defaultBanner from \"../../images/banner-bg.jpg\";\nimport av1 from \"../../images/av1.jpg\";\nimport shockLogo from \"../../images/lightning-logo.svg\";\nimport \"./css/index.css\";\nimport ReactTooltip from \"react-tooltip\";\n\nconst Post = React.lazy(() => import(\"../../components/Post\"));\n\nconst ONLINE_INTERVAL = 1 * 30 * 1000;\n\nconst UserPage = () => {\n  const dispatch = useDispatch();\n  const params = useParams();\n  const wall = useSelector(({ user }) => user.wall);\n  const profile = useSelector(({ user }) => user.profile);\n  const me = useSelector(({ auth }) => auth.pair);\n  const paymentRequest = useSelector(\n    ({ transaction }) => transaction.paymentRequest\n  );\n  // Reserved for future use\n  // eslint-disable-next-line no-unused-vars\n  const [userLoading, setUserLoading] = useState(true);\n  const [wallLoading, setWallLoading] = useState(true);\n  const [tipModalOpen, setTipModalOpen] = useState(false);\n  const [tipLoading, setTipLoading] = useState(false);\n  const [tipAmount, setTipAmount] = useState(10);\n  const [isOnlineApp, setIsOnlineApp] = useState(false);\n  const [isOnlineNode, setIsOnlineNode] = useState(false);\n  const [copied, setCopied] = useState(false);\n\n  const [onlineCheckTimer, setOnlineCheckTimer] = useState(null);\n  const [tipMetadata, setTipMetadata] = useState({ targetType: \"user\" });\n\n  const publicKey = params.userId;\n\n  const fetchUserData = useCallback(async () => {\n    try {\n      setUserLoading(true);\n      dispatch(resetUserData());\n      const user = await dispatch(getUserProfile(publicKey));\n      console.log(user);\n      setUserLoading(false);\n      // Load user avatar in the background\n      dispatch(getUserHeader(publicKey));\n      await dispatch(getUserAvatar(publicKey));\n    } catch (err) {\n      console.error(err);\n      setUserLoading(false);\n    }\n  }, [dispatch, publicKey]);\n\n  const fetchUserWall = useCallback(async () => {\n    try {\n      console.log(\"Setting Loading status to:\", true);\n      setWallLoading(true);\n      dispatch(resetUserWall());\n      await dispatch(getUserWall(publicKey));\n      console.log(\"Setting Loading status to:\", false);\n      setWallLoading(false);\n    } catch (err) {\n      console.error(err);\n      console.log(\"Setting Loading status to:\", false);\n      setWallLoading(false);\n    }\n  }, [dispatch, publicKey]);\n\n  const sendTip = useCallback(async () => {\n    try {\n      setTipLoading(true);\n      await dispatch(\n        payUser({\n          senderPair: me,\n          recipientPublicKey: publicKey,\n          amount: tipAmount,\n          metadata: tipMetadata\n        })\n      );\n      setTipLoading(false);\n    } catch (err) {\n      console.error(err);\n    }\n  }, [dispatch, me, publicKey, tipAmount, tipMetadata]);\n\n  const openTipModal = (metadata = { targetType: \"user\" }) => {\n    setTipMetadata(metadata);\n    setTipModalOpen(true);\n  };\n\n  const closeTipModal = useCallback(() => {\n    setTipModalOpen(false);\n    setTipMetadata({});\n    if (paymentRequest) {\n      dispatch(resetPaymentRequest());\n      setTipLoading(false);\n    }\n  }, [dispatch, paymentRequest]);\n\n  const initializeUserWall = useCallback(async () => {\n    await fetchUserData();\n    await dispatch(generateGunPair());\n    fetchUserWall();\n  }, [dispatch, fetchUserData, fetchUserWall]);\n\n  useEffect(() => {\n    initializeUserWall();\n\n    // Subscribe for updates\n    const lastSeenAppListener = listenPath({\n      path: \"Profile/lastSeenApp\",\n      gunPointer: gunUser(publicKey),\n      callback: event => {\n        dispatch(updateUserProfile({ lastSeenApp: event }));\n      }\n    });\n\n    const lastSeenNodeListener = listenPath({\n      path: \"Profile/lastSeenNode\",\n      gunPointer: gunUser(publicKey),\n      callback: event => {\n        dispatch(updateUserProfile({ lastSeenNode: event }));\n      }\n    });\n\n    const displayNameListener = listenPath({\n      path: \"Profile/displayName\",\n      gunPointer: gunUser(publicKey),\n      callback: event => {\n        dispatch(updateUserProfile({ displayName: event }));\n      }\n    });\n\n    const bioListener = listenPath({\n      path: \"Profile/bio\",\n      gunPointer: gunUser(publicKey),\n      callback: event => {\n        dispatch(updateUserProfile({ bio: event }));\n      }\n    });\n\n    return () => {\n      lastSeenAppListener.off();\n      lastSeenNodeListener.off();\n      displayNameListener.off();\n      bioListener.off();\n    };\n  }, [dispatch, initializeUserWall, publicKey]);\n\n  useEffect(() => {\n    attachMedia(wall.posts, false);\n  }, [wall.posts]);\n\n  useEffect(() => {\n    if (onlineCheckTimer) {\n      clearTimeout(onlineCheckTimer);\n    }\n\n    const timer = setTimeout(() => {\n      const onlineThreshold = Moment.utc().subtract(ONLINE_INTERVAL, \"ms\");\n      const isOnlineNode = profile.lastSeenNode\n        ? Moment.utc(profile.lastSeenNode).isSameOrAfter(onlineThreshold)\n        : false;\n      const isOnlineApp = profile.lastSeenApp\n        ? Moment.utc(profile.lastSeenApp).isSameOrAfter(onlineThreshold)\n        : false;\n\n      setIsOnlineNode(isOnlineNode);\n      setIsOnlineApp(isOnlineApp);\n    }, ONLINE_INTERVAL);\n\n    setOnlineCheckTimer(timer);\n\n    return () => clearTimeout(onlineCheckTimer);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [profile]);\n\n  useEffect(() => {\n    const onlineThreshold = Moment.utc().subtract(1, \"minutes\");\n    const isOnlineNode = profile?.lastSeenNode\n      ? Moment.utc(profile?.lastSeenNode).isSameOrAfter(onlineThreshold)\n      : false;\n    const isOnlineApp = profile?.lastSeenApp\n      ? Moment.utc(profile?.lastSeenApp).isSameOrAfter(onlineThreshold)\n      : false;\n\n    setIsOnlineNode(isOnlineNode);\n    setIsOnlineApp(isOnlineApp);\n  }, [profile]);\n\n  const setCopiedStatus = useCallback(() => {\n    setCopied(true);\n    ReactTooltip.rebuild();\n    setTimeout(() => {\n      setCopied(false);\n      ReactTooltip.rebuild();\n    }, 500);\n  }, []);\n\n  const username = profile.displayName ?? profile.alias;\n\n  return (\n    <div className=\"user-page\">\n      <div\n        className=\"top-banner\"\n        style={{\n          backgroundImage: `url(${\n            profile.header\n              ? `data:image/png;base64,${profile.header}`\n              : defaultBanner\n          })`\n        }}\n      ></div>\n      <div className=\"user-details\">\n        <div\n          className=\"main-av\"\n          style={{\n            backgroundImage: `url(${\n              profile.avatar ? `data:image/png;base64,${profile.avatar}` : av1\n            })`\n          }}\n        ></div>\n\n        <div className=\"details\">\n          <div className=\"user-info\">\n            <p className=\"username\">{username}</p>\n\n            <div className=\"activity\">\n              <p\n                className=\"status\"\n                style={\n                  !isOnlineApp\n                    ? {\n                        color: isOnlineApp\n                          ? \"#01a33d\"\n                          : isOnlineNode\n                          ? \"#f2a900\"\n                          : \"#888\"\n                      }\n                    : {}\n                }\n              >\n                {isOnlineApp\n                  ? \"Active Recently\"\n                  : isOnlineNode\n                  ? \"Node Online\"\n                  : \"Node Offline\"}\n              </p>\n            </div>\n\n            {profile.bio ? (\n              <div className=\"desc\">\n                <p className=\"title\">Bio</p>\n                <p>{profile.bio}</p>\n              </div>\n            ) : null}\n          </div>\n\n          <div\n            className=\"send-tip-btn\"\n            onClick={() => (isOnlineNode ? setTipModalOpen(true) : null)}\n            style={{\n              opacity: isOnlineNode ? 1 : 0.5,\n              cursor: isOnlineNode ? \"pointer\" : \"default\"\n            }}\n            data-tip={\n              !isOnlineNode ? \"You can only tip users with online nodes\" : null\n            }\n          >\n            <img src={shockLogo} alt=\"Bitcoin Lightning\" />\n            <p>Send Tip</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"tabs-holder\">\n        <p className=\"tab active\">Feed</p>\n      </div>\n      <div className=\"posts-holder\">\n        {wall.posts.map(post => (\n          <Suspense\n            fallback={\n              <div className=\"post-loading\">\n                <Loader text=\"Loading Post...\" />\n              </div>\n            }\n            key={post.id}\n          >\n            <Post\n              timestamp={post.date}\n              contentItems={post.contentItems}\n              username={username}\n              avatar={\n                profile.avatar ? `data:image/png;base64,${profile.avatar}` : av1\n              }\n              publicKey={publicKey}\n              openTipModal={openTipModal}\n              webTorrentClient={webTorrentClient}\n              page={post.page}\n              id={post.id}\n              tipValue={post.tipValue ?? 0}\n              tipCounter={post.tipCounter ?? 0}\n              isOnlineNode={isOnlineNode}\n            />\n          </Suspense>\n        ))}\n      </div>\n      {wallLoading ? (\n        <Loader text={`Loading ${wall.page >= 0 ? \"More\" : \"Wall\"} Posts...`} />\n      ) : null}\n      {tipModalOpen ? (\n        <div className=\"tip-modal-container\">\n          <div className=\"tip-modal-overlay\" onClick={closeTipModal}></div>\n          <div className=\"tip-modal\">\n            {tipLoading ? (\n              <div className=\"tip-modal-loading\">\n                <Loader text=\"Submitting Tip Request...\" />\n              </div>\n            ) : null}\n            <div className=\"tip-modal-head\">\n              <div className=\"tip-modal-title\">Send Tip</div>\n            </div>\n            {paymentRequest ? (\n              <div className=\"tip-modal-content\">\n                <p className=\"tip-modal-instructions\">\n                  We've successfully generated an invoice for you to tip, please\n                  scan the QR Code below using a Lightning wallet to pay it!\n                </p>\n                <div className=\"tip-modal-qr-code-container\">\n                  <QRCode\n                    className=\"tip-modal-qr-code\"\n                    value={paymentRequest}\n                    size={210}\n                    bgColor=\"#4db1ff\"\n                    fgColor=\"#1b2129\"\n                  />\n                </div>\n                <div className=\"tip-modal-action-btns\">\n                  <a\n                    href={`lightning:${paymentRequest}`}\n                    className=\"tip-modal-action-btn\"\n                  >\n                    PAY INVOICE\n                  </a>\n                  <CopyClipboard text={paymentRequest} onCopy={setCopiedStatus}>\n                    <div className=\"tip-modal-action-btn\">\n                      {copied ? \"INVOICE COPIED!\" : \"COPY INVOICE\"}\n                    </div>\n                  </CopyClipboard>\n                </div>\n              </div>\n            ) : (\n              <div className=\"tip-modal-content\">\n                <p className=\"tip-modal-instructions\">\n                  Please specify the amount of sats you'd like to tip this user\n                  with below and we'll generate an invoice for you to scan.\n                </p>\n                <input\n                  className=\"tip-modal-input\"\n                  value={tipAmount}\n                  onChange={e => setTipAmount(e.target.value)}\n                />\n              </div>\n            )}\n            {!paymentRequest ? (\n              <div className=\"tip-modal-footer\" onClick={() => sendTip()}>\n                <div className=\"tip-modal-submit\">SEND TIP</div>\n              </div>\n            ) : null}\n          </div>\n        </div>\n      ) : null}\n    </div>\n  );\n};\n\nexport default UserPage;\n"],"sourceRoot":""}