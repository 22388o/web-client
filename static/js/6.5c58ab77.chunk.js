(this["webpackJsonpshockwallet-web"]=this["webpackJsonpshockwallet-web"]||[]).push([[6,7],{128:function(e,t,a){"use strict";var n=a(0),c=a.n(n);a(155);t.a=function(e){var t=e.icon,a=void 0===t?"link":t,n=e.text;return e.visible?c.a.createElement("div",{className:"notice-bar"},c.a.createElement("i",{className:"fas fa-".concat(a)}),n):null}},155:function(e,t,a){},263:function(e,t){},265:function(e,t){},273:function(e,t,a){"use strict";a.r(t);var n=a(8),c=a(0),r=a.n(c),i=a(120),l=a.n(i),o=a(114),s=a(32),u=a(272),d=a(260),m=a.n(d),p=a(24),b=a(13),f=(a(86),a(1)),v=function(e){var t=e.tipCounter,a=e.tipValue,n=e.zoomed;return a>0?r.a.createElement("div",{className:"ribbon-container",style:{opacity:n?0:1}},r.a.createElement("p",{className:"ribbon-title"},"Total Tips"),r.a.createElement("p",{className:"ribbon-value"},t," ",1===t?"Tip":"Tips")):null},E=function(e){var t=e.id,a=e.item,n=e.index,c=e.postId,i=e.tipValue,l=e.tipCounter;return r.a.createElement("div",{className:"media-container"},r.a.createElement("div",{className:"video-container",style:{cursor:"pointer"}},r.a.createElement("video",{className:"torrent-video torrent-video-".concat(c,"-").concat(t),"data-torrent":a.magnetURI,"data-file-key":n,controls:!0,"data-played":"false"}),r.a.createElement(v,{tipCounter:l,tipValue:i})))},j=a(533),O=(a(261),function(e){var t=e.id,a=e.item,i=e.index,l=e.postId,o=e.tipValue,s=e.tipCounter,u=Object(c.useState)(!1),d=Object(n.a)(u,2),m=d[0],p=d[1],b=Object(c.useState)(!1),f=Object(n.a)(b,2),E=f[0],O=f[1],h=Object(c.useState)(!0),k=Object(n.a)(h,2),g=k[0],N=k[1],y=Object(c.useState)(null),C=Object(n.a)(y,2),w=C[0],x=C[1],I=Object(c.useCallback)((function(e){if(clearTimeout(w),p(e),!e&&E){O(!1);var t=setTimeout((function(){N(!0)}),200);x(t)}e&&N(!1)}),[w,E]);return r.a.createElement("div",{className:"media-container"},r.a.createElement(j.a,{isZoomed:m,onZoomChange:I,overlayBgColorStart:"#16191c00",overlayBgColorEnd:"#16191c"},r.a.createElement("img",{className:"torrent-img torrent-img-".concat(l,"-").concat(t),alt:"Post Media","data-torrent":a.magnetURI,"data-file-key":i,style:{opacity:g?1:0}}),r.a.createElement("img",{className:"enlarged-img enlarged-img-".concat(l,"-").concat(t),alt:"Post Media","data-file-key":i,onLoad:function(){O(!0)},style:{opacity:E?1:0},src:decodeURIComponent(a.magnetURI.split("ws=")[1])}),r.a.createElement(v,{tipCounter:s,tipValue:o,zoomed:m})))}),h=a(2),k=a.n(h),g=a(6),N=a(275),y="".concat("https://webtorrent.shock.network","/rtmpapi/api/streams/live"),C=function(e){e.id;var t=e.item,a=(e.index,e.postId,e.tipValue),i=e.tipCounter,l=e.hideRibbon,o=e.width,s=Object(c.useRef)(null),u=Object(c.useState)(!1),d=Object(n.a)(u,2),m=d[0],p=d[1],b={width:"100%"};return o&&(b.width=o),Object(c.useEffect)((function(){if(t){var e=null,a=function(){var e=Object(g.a)(k.a.mark((function e(){var a,c,r,i,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.magnetURI.split("/live/")[1].split("/index.m3u8"),c=Object(n.a)(a,1),r=c[0],e.next=4,fetch("".concat(y,"/").concat(r));case 4:return i=e.sent,e.next=7,i.json();case 7:if(e.sent.isLive){e.next=10;break}return e.abrupt("return",!1);case 10:return(l=Object(N.a)(s.current,{autoplay:!0,muted:!0,aspectRatio:"16:9"})).src({src:t.magnetURI,type:"application/x-mpegURL"}),l.play(),e.abrupt("return",!0);case 16:return e.prev=16,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}();return a().then((function(t){t?p(!0):e=setInterval(Object(g.a)(k.a.mark((function t(){return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a();case 2:if(!t.sent){t.next=7;break}return p(!0),clearInterval(e),t.abrupt("return");case 7:case"end":return t.stop()}}),t)}))),1e4)})),function(){clearInterval(e)}}}),[t]),r.a.createElement("div",{className:"media-container w-100"},r.a.createElement("div",{className:"video-container w-100",style:{cursor:"pointer",width:"100%"}},!m&&r.a.createElement("p",null,"The streamer has disconnected."),r.a.createElement("div",{style:m?{width:"100%"}:{display:"none",width:"100%"}},r.a.createElement("video",{className:"video-js vjs-default-skin",ref:s,style:b,preload:"auto",controls:!0,muted:!0,autoPlay:!0})),!l&&r.a.createElement(v,{tipCounter:i,tipValue:a,zoomed:!1})))},w=a(128),x=a(129),I=a.n(x),S=function(e){var t=e.publicKey,a=e.id,i=e.username,l=e.pinned,s=Object(c.useState)(!1),u=Object(n.a)(s,2),d=u[0],m=u[1],p=Object(c.useMemo)((function(){return"https://shock.pub/".concat(t,"/post/").concat(a)}),[t,a]),b=Object(c.useCallback)(Object(g.a)(k.a.mark((function e(){return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!navigator.share){e.next=3;break}return navigator.share({text:"Check out this post from ".concat(i," on ShockWallet!"),url:p}),e.abrupt("return");case 3:case"end":return e.stop()}}),e)}))),[i,p]),f=Object(c.useCallback)((function(){m(!0)}),[]),v=Object(c.useCallback)((function(){return d?"Post link copied!":"Share this post"}),[d]);if(Object(c.useEffect)((function(){o.a.rebuild();var e=setTimeout((function(){m(!1),o.a.rebuild()}),1e3);return function(){clearTimeout(e)}}),[d]),Object(c.useEffect)((function(){o.a.rebuild()}),[]),!navigator.share){var E="share-".concat(t,"-").concat(l?"pinned":"","-").concat(a);return r.a.createElement(I.a,{text:p,onCopy:f},r.a.createElement("div",{className:"share-btn-container"},r.a.createElement("div",{className:"share-btn","data-tip":v(),"data-for":E},r.a.createElement("i",{className:"fas fa-external-link-alt"})),r.a.createElement(o.a,{effect:"solid",backgroundColor:"#3a4d67",getContent:[v,30],id:E})))}return r.a.createElement("div",{className:"share-btn",onClick:b},r.a.createElement("i",{className:"fas fa-external-link-alt"}))};t.default=function(e){var t=e.id,a=e.timestamp,i=e.avatar,d=e.tipCounter,v=e.tipValue,j=e.publicKey,h=e.openTipModal,k=e.contentItems,g=void 0===k?{}:k,N=e.username,y=e.isOnlineNode,x=e.shared,I=e.pinned,T=Object(s.b)(),V=Object(u.useEmblaCarousel)({slidesToScroll:1,align:"center"}),P=Object(n.a)(V,2),L=P[0],R=P[1],U=Object(c.useState)(0),K=Object(n.a)(U,2),M=K[0],A=K[1],D=Object(c.useState)(0),z=Object(n.a)(D,2),B=z[0],J=z[1],Z=Object(c.useState)(""),W=Object(n.a)(Z,2),q=W[0],F=W[1];Object(c.useEffect)((function(){var e=Object.values(g),t=e.find((function(e){return"video/embedded"===e.type&&"wasLive"===e.liveStatus})),a=e.find((function(e){return"stream/embedded"===e.type&&"live"===e.liveStatus})),n="";t&&(n=t.liveStatus),a&&(n=a.liveStatus),n&&F(n)}),[g,F]);var G=function(e,a){var c=Object(n.a)(e,2),i=c[0],l=c[1];return"text/paragraph"===l.type?r.a.createElement("p",{key:i},l.text):"image/embedded"===l.type?r.a.createElement(O,{id:i,item:l,index:a,postId:t,tipCounter:d,tipValue:v,key:"".concat(t,"-").concat(a)}):"video/embedded"===l.type?r.a.createElement(E,{id:i,item:l,index:a,postId:t,tipCounter:d,tipValue:v,key:"".concat(t,"-").concat(a)}):"stream/embedded"===l.type?r.a.createElement(C,{id:i,item:l,index:a,postId:t,tipCounter:d,tipValue:v,key:"".concat(t,"-").concat(a)}):null},H=Object(c.useCallback)((function(){R&&R.canScrollNext()&&R.scrollNext()}),[R]),Q=Object(c.useCallback)((function(){R&&R.canScrollPrev()&&R.scrollPrev()}),[R]),X=Object(c.useCallback)((function(e){if(0!==M){var t=e.key;"ArrowRight"===t&&H(),"ArrowLeft"===t&&Q()}}),[M,Q,H]),Y=Object(c.useCallback)((function(){J(R.selectedScrollSnap())}),[R,J]);Object(c.useEffect)((function(){Object(f.f)({path:"posts/".concat(t,"/tipsSet"),gunPointer:Object(f.g)(j),method:"load"}).then((function(e){var a=e?Object.values(e):[],n=a.length,c=n>0?a.reduce((function(e,t){return Number(t)+Number(e)})):0;T(Object(b.l)({postID:t,data:{tipValue:c,tipCounter:n}}))}))}),[T,t,j]),Object(c.useEffect)((function(){if(R)return R.on("scroll",Y),A(R.scrollSnapList().length),window.addEventListener("keydown",X),function(){window.removeEventListener("keydown",X),R.off("scroll",Y)}}),[R,M,X,Y]);var $=Object(c.useCallback)((function(){y&&h({targetType:"tip",ackInfo:t})}),[t,y,h]);return Object(c.useEffect)((function(){o.a.rebuild()}),[]),r.a.createElement("div",{className:"post"},r.a.createElement(w.a,{text:"Linked post",visible:I&&!x}),r.a.createElement("div",{className:"head"},r.a.createElement("div",{className:"user"},r.a.createElement(p.b,{className:"av",to:"/".concat(j),style:{backgroundImage:"url(".concat(i,")")}}),r.a.createElement("div",{className:"details"},r.a.createElement("div",{className:"username"},r.a.createElement(p.b,{to:"/otherUser/".concat(j)},N),q&&r.a.createElement("p",{className:"liveStatus"},q,r.a.createElement("i",{className:"fas fa-circle liveStatusIcon ".concat("live"===q?"liveIcon":"")}))),r.a.createElement("p",null,l.a.utc(a).fromNow()))),r.a.createElement(S,{publicKey:j,id:t,username:N,pinned:I})),r.a.createElement("div",{className:"content"},Object.entries(g).filter((function(e){var t=Object(n.a)(e,2);return t[0],"text/paragraph"===t[1].type})).map(G),r.a.createElement("div",{className:"media-content-carousel"},M>1?r.a.createElement("div",{className:"media-carousel-controls-container"},r.a.createElement("div",{className:"media-carousel-arrow fas fa-angle-left",onClick:Q}),r.a.createElement("div",{className:"media-carousel-pages"},Array.from({length:M}).map((function(e,t){return r.a.createElement("div",{className:m()({"media-carousel-page":!0,"active-carousel-page":B===t}),onClick:function(){return null===R||void 0===R?void 0:R.scrollTo(t)}})}))),r.a.createElement("div",{className:"media-carousel-arrow fas fa-angle-right",onClick:H})):null,r.a.createElement("div",{className:"media-content-root",ref:L},r.a.createElement("div",{className:"media-content-container"},Object.entries(g).filter((function(e){var t=Object(n.a)(e,2);return t[0],"text/paragraph"!==t[1].type})).map(G))))),r.a.createElement("div",{className:"actions"},r.a.createElement("div",{className:"icon-tip-btn","data-tip":"Tip this post",onClick:$},r.a.createElement("i",{className:"tip-icon icon-thin-feed"})),r.a.createElement(o.a,{backgroundColor:"#3a4d67",effect:"solid"})))}},532:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a.n(n),r=a(6),i=a(8),l=a(0),o=a.n(l),s=a(120),u=a.n(s),d=a(114),m=a(32),p=a(13),b=a(1),f=a(273),v=a(259),E=a.n(v),j=(a(86),a(274)),O=a(34),h=a(128);t.default=function(e){var t,a=e.sharedPostId,n=e.sharerPublicKey,s=e.sharerUsername,v=e.sharerAvatar,k=e.sharedTimestamp,g=e.isOnlineNode,N=e.postID,y=e.postPublicKey,C=e.openTipModal,w=e.pinned,x=Object(m.b)(),I=Object(l.useState)(!0),S=Object(i.a)(I,2),T=S[0],V=S[1],P=Object(l.useState)(null),L=Object(i.a)(P,2),R=L[0],U=L[1],K=Object(l.useState)(null),M=Object(i.a)(K,2),A=M[0],D=M[1];Object(l.useEffect)((function(){Object(b.h)({path:"posts/".concat(a,"/tipCounter"),gunPointer:Object(b.g)(n),callback:function(e){x(Object(p.l)({postID:a,data:{tipCounter:e}}))}}),Object(b.h)({path:"posts/".concat(a,"/tipValue"),gunPointer:Object(b.g)(n),callback:function(e){x(Object(p.l)({postID:a,data:{tipValue:e}}))}})}),[x,a,n]);var z=Object(l.useCallback)(Object(r.a)(c.a.mark((function e(){var t,a,n,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(V(!0),y){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all([Object(p.b)({publicKey:y,includeAvatar:!0}),Object(p.f)({id:N,gunPointer:Object(b.g)(y)})]);case 5:t=e.sent,a=Object(i.a)(t,2),n=a[0],r=a[1],D(n),U(r),V(!1),Object(j.a)([r],!1);case 13:case"end":return e.stop()}}),e)}))),[N,y]);return Object(l.useEffect)((function(){d.a.rebuild(),z()}),[z]),o.a.createElement("div",{className:"post shared-post"},o.a.createElement(h.a,{text:"Linked post",visible:w}),o.a.createElement("div",{className:"head"},o.a.createElement("div",{className:"user"},o.a.createElement("div",{className:"av",style:{backgroundImage:"url(".concat(v,")")}}),o.a.createElement("div",{className:"details"},o.a.createElement("p",null,s),o.a.createElement("p",null,u.a.utc(k).fromNow())))),o.a.createElement("div",{className:"shared-content"},T?o.a.createElement(O.a,{text:"Loading Post..."}):R&&A?o.a.createElement(f.default,{id:R.id,timestamp:R.date,avatar:A.avatar?"data:image/png;base64,".concat(A.avatar):E.a,tipCounter:R.tipCounter,tipValue:R.tipValue,publicKey:y,openTipModal:C,contentItems:R.contentItems,username:null!==(t=A.displayName)&&void 0!==t?t:A.alias,isOnlineNode:g,shared:!0,pinned:w}):null))}},86:function(e,t,a){}}]);
//# sourceMappingURL=6.5c58ab77.chunk.js.map